---
title: "BMIN503/EPID600 Project"
author: "Emily Johnson"
output: 
  html_document:
    toc: false 
    depth: 3 
    theme: paper 
    highlight: tango
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 400)
```  
***
Use this template to complete your project throughout the course. Your Final Project presentation in class will be based on the contents of this document. Replace the title/name and text below with your own, but keep the headers.

### Overview
In this section, give a brief a description of your project and its goal, what data you are using to complete it, and what three faculty/staff in different fields you have spoken to about your project with a brief summary of what you learned from each person. Include a link to your final project GitHub repository.

>Neonatal abstinence syndrome (NAS) is is a postnatal opioid withdrawal syndrome, characterized by impaired respiration, feeding, and weight gain, which affects a newborn every 25 minutes in the United States (Patrick et al, 2015). I will performing both an epidemiological analysis of NAS and a single cell RNA sequencing analysis for fetal midbrain development, as NAS is controlled by the midbrain dopaminergic pathway, and this healthy fetal development analysis will be used to compare NAS single cell RNA sequencing data at a later date. 


# Introduction 
In the first paragraph, describe the problem addressed, its significance, and some background to motivate the problem.

In the second paragraph, explain why your problem is interdisciplinary, what fields can contribute to its understanding, and incorporate background related to what you learned from meeting with faculty/staff.

>The human brain and its development are immensely complex, and during development the brain is especially vulnerable to external toxicity and injury. Opioid use is on the rise in the United States, with 11.3% of Americans abusing non-prescription opioids in their lifetime, in what has been described as an epidemic (Saha et al, 2016). This increase in opioid use disorder (OUD) extends to mothers, and as maternal OUD increases, so does neonatal abstinence syndrome (NAS). Neonatal abstinence syndrome is a postnatal opioid withdrawal syndrome, characterized by impaired respiration, feeding, and weight gain (McQueen et al, 2016). There is also evidence that opioid exposure during pregnancy and infanthood results in epigenetic changes in future generations (Maguire et al, 2016). Incidence of NAS increased nearly fivefold between 2000 and 2012, and by 2012 an infant was born with the syndrome every 25 minutes in the US (Patrick et al, 2015). In addition to the negative effects of the syndrome on infants, the uptick in NAS has significant economic consequencesâ€”the syndrome accounts for a total of $1.5 billion in hospital charges, and approximately 80% of infants born with NAS in the US are enrolled in Medicaid (Patrick et al, 2015). Thus, opioid exposure in utero gives rise to numerous detrimental short-term and long-term effects at an individual and societal level.

> Despite the wide impact of NAS, there is little research on it's effects, especially on the molecular and cellular level. For my project I plan to dually take an epidemiological and molecular approach to reviewing NAS, and this interdiscioplinary approach can hopefully help develop a fuller picture of NAS. 

# Methods
In the first paragraph, describe the data used and general methodological approach. Subsequently, incorporate full R code necessary to retrieve and clean data, and perform analysis. Be sure to include a description of code so that others (including your future self) can understand what you are doing and why. 

> For the epidemiological look at NAS, I have used multiple datasets from Pennsylvania Health Care Cost Containment Council (PHC4) found on opendataPA. I am using a combination of data on the rise of opioid use and overdoses, data on NAS and meternal opioid use disorder by county in 2016, and data on NAS and maternal OUD for all of Pennsylvania both overtime and in 2016. The combination of these statistics should provide a background for the opioid epidemic and need for more research into NAS. 

>The molecular analysis takes counts from "Molecular Diversity of Midbrain Development in Mouse, Human, and Stem Cells" published by La Manno et al in 2016. The data was accessed from Gene Expression Omnibus (GEO) at GSE76381. This data includes markers of ventral midbrain development in human cells and stem cells, which I will be looking at to see cell types at different stages of development and gene expressions in specific cell types for healthy development of dopaminergic neurons. I have previously worked on a study to model NAS with stem cell derived organoids, so this developmental data will be used down the line for comparison to our experinental RNAseq results. 


## Epidemiology of NAS 

### Loading and cleaning data 
Data from PHC4 via opendataPA 
``` {r eval = TRUE}
#Overall overdose incidents 
overdose <- read.csv("Overdose_Information_Network_Data_CY_January_2018_-_Current_Monthly_County_State_Police.csv")

#Data by county 
county.OUD.stays <- read.csv("Maternal_Opioid__Use_Hospital_Stays_2016-2017_County_Health_Care_Cost_Containment_Council__PHC4_.csv")

county.withdrawal.stays <- read.csv("Rate_of_Neonatal_Hospital_Stays_with_Withdrawal_Symptoms_from_Maternal_Use_of_Drugs_of_Addiction_CY_2016-Current_County_Health_Care_Cost_Containment_Council__PHC4_.csv")

county.OUD.diagnosis <- read.csv("Rate_of_Women_Diagnosed_with_Opioid_Use_Disorder__OUD__during_Pregnancy_CY_2016_-_Current_Statewide_Health_Care_Cost_Containment_Council__PHC4_.csv")

county.MA <- read.csv("Rate_of_Women_on_Medical_Assistance__MA__Diagnosed_with_Opioid_Use_Disorder__OUD__during_Pregnancy_CY_2016-Current_Statewide_Department_of_Human_Services__DHS_.csv")

#Data for PA over time 
rate.of.NAS <- read.csv("Rate_of_Neonatal_Abstinence_Syndrome_per_1_000_Newborn_Stays_FYs_2000-2001_to_FYs_2016-2017_Statewide_Health_Care_Cost_Containment_Council__PHC4_.csv")

rate.of.OUD <- read.csv("Statewide_Maternal_Hospital_Stays_Opioid_Use_Rates_2000_to_present__PA_Health_Care_Cost_Containment_Council__PHC4_.csv")


#Data for PA in 2016 
PA.gestation.stage <- read.csv("Statewide_Delivery_Stays_Percent_of_Gestation_Stages_with_or_without_Opioid_Use_2016-2017_PA_Health_Care_Cost_Containment_Council__PHC4_.csv")

PA.readmission <- read.csv("Statewide_Delivery_Stays_Percent_Readmitted_with_or_without_Opioid_Use_2016-2017_PA_Health_Care_Cost_Containment_Council__PHC4_.csv")

PA.medicaid.OUD <- read.csv("Statewide_Maternal_Stays_percent_Medicaid_with_or_without_Opioid_Use_2016-2017_PA_Health_Care_Cost_Containment_Council__PHC4_.csv")

PA.medicaid.NAS<- read.csv("Newborn_Hospital_Stays_with_Neonatal_Abstinence_Syndrome_Percent_Paid_by_Medicaid_Statewide_Health_Care_Cost_Containment_Council__PHC4_.csv")

``` 

## Molecular Analysis of Midbrain Development 

### Libraries
``` {r eval = TRUE}
library(dplyr)
library(Seurat)
library(edgeR)
library(limma)
library(Glimma)
library(gplots)
library(org.Mm.eg.db)
library(RColorBrewer)
```

### Reading in data 
Reading in count data (not raw). There are 5 types of count data: iPSCs, ESCs, embryos, mouse adult dopaminergic cells, and mouse embryos. 
```{r eval = TRUE} 
ips <- read.delim("GSE76381_iPSMoleculeCounts.cef.txt", stringsAsFactors = FALSE)
embryo <- read.delim("GSE76381_EmbryoMoleculeCounts.cef.txt", stringsAsFactors = FALSE)
es<- read.delim("GSE76381_ESMoleculeCounts.cef.txt", stringsAsFactors = FALSE)
mouse.adult.da <- read.delim("GSE76381_MouseAdultDAMoleculeCounts.cef.txt", stringsAsFactors = FALSE)
mouse.embryo <- read.delim("GSE76381_MouseEmbryoMoleculeCounts.cef.txt", stringsAsFactors = FALSE)

ips.seurat <- CreateSeuratObject(counts = ips, project = "BMIN", min.cells = 0, min.features = 0)
embryo.seurat <- CreateSeuratObject(counts = embryo, project = "BMIN", min.cells = 0, min.features = 0)
es.seurat <- CreateSeuratObject(counts = es, project = "BMIN", min.cells = 0, min.features = 0)
mouse.adult.da.seurat <- CreateSeuratObject(counts = mouse.adult.da, project = "BMIN", min.cells = 0, min.features = 0)
mouse.embryo.seurat <- CreateSeuratObject(counts = mouse.embryo, project = "BMIN", min.cells = 0, min.features = 0)

```

### Formatting Data
renaming each column to cell IDs
``` {r eval = TRUE}
names(ips) <- ips[1, ]
ips <- ips[-1,]
ips.counts <- ips[-(1:3),-2]

names(embryo) <- embryo[1, ]
embryo <- embryo[-1,]

names(ips) <- ips[1, ]
ips <- ips[-1,]

names(es) <- es[1, ]
es <- es[-1,]

names(mouse.adult.da) <- mouse.adult.da[1, ]
mouse.adult.da <- mouse.adult.da[-1,]

names(mouse.embryo) <- mouse.embryo[1, ]
mouse.embryo <- mouse.embryo[-1,]

```

### Cleaning Data 
Finding expression levels 
``` {r eval = TRUE}

counts_per_cell <- Matrix::colSums(ips)
counts_per_gene <- Matrix::rowSums(ips)
genes_per_cell <- Matrix::colSums(ips>0)

```

# Results
Describe your results and include relevant tables, plots, and code/comments used to obtain them. End with a brief conclusion of your findings related to the question you set out to address. You can include references if you'd like, but this is not required.

## Epidemiology of NAS

### Overdoses 
#### Introduce the epidemic 
Map of overdose rate by county in PA 

Graph of overdoses over the past year in Philadelphia by month 

Graph of overdose broken by drug type, to see trends in overdose cause

### NAS PA data 
#### How NAS affects individuals and society 
Graph of rate of NAS over time increase 

Graph of gestational state

Graph of readmission 

Graph of PA medicaid/medicare 

### Philadelphia data
#### Who does this affect in PHiladelphia? 

Graph of demographics of mothers with maternal OUD 

Graph of rate of hospital stays

Graph of percentage on medical assistance with NAS 

## Molecular Analysis of Midbrain Development 

tsne 

heatmap and dotplot: cell types of human embryonic midbrain 

violin plot: human genes specifically expressed in mutually best-matching cell types

selected genes expressed above baseline for embryo and adult 

selected genes expressed above baseline for hiPSC and eSC

hiPSC cell types compared to in vivo cell types 

hESC cell types compared to in vivo cell types 
